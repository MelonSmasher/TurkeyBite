#! /bin/sh


cat <<EOF                                                                          
                                                                                
                                            *@@                                 
                                 @#%%%%####%####@                               
                                #%%%%%%%%%#######%                              
                               @%%%%%%%%%#########                              
                              @#%%%%%@@@%%%%%%%%%@@                             
                              @@%%%%%%%%%%%%#%%%%%#@                            
                              @%@@@@%################@%@                        
                         @@#%%%%%%%%%##%###***####*########@                    
                       %%%%%@@@%%#%%%%######%#######@@%@%@-                     
                         @@%%@%##%**##@#*****#*****#@%                          
                         .   @%##@@*#%.:%@##*@*#*@@@@:                          
                      ++++++++##***#%@@#@@%@@*@@@@@.# @%                        
                +++++%++%#%%%@@##***#@@....%@===-%.@@ @                         
              *++++%%%@@##%%%%%@##*****@%*#@======-@@+                          
               ++%%%%%%%@%%@%%%%%@##***@+=++++++===-@   *@************#@@       
           ++++%@%%%%%%%#%%#%%%%%%%@@#*+@==+++++#@+=@ @#%@@@#%##%***@@-=        
          +++%%%%%@#%%%%%@%%@%%%%%%@%%####@%@@     @  #::-:.......@..=.@%       
         *++%%%%%%%%@%%%%%%%%%%@%%%@%%@#**@#**.     -%%@%##*@@@:..*.@#@%@       
           *%%%%%%%%%@%%%%%@%%%@%%@%%%@#**@#**#     @%%###*#**##%%@%@@@=%       
        +++%%@%%%%%%%%%@%%%%%%%@@@@%%%@#*###**#      @%%%#%#-=-...:-:...%       
       *++%%%%%%%@%%%%%%%%%%##%%#%#%%%#*****#**-    *@#%@%%#:-...=@@@#%%%@      
       +++%%%%%%%%%@%%%%%############%@#**##****%    -=-%#%@@@@%#%#*@%%@@       
        ++%%%%%%%%%%%%@@########%%%###@##@*****%#%# @#-=---=@-==....-..@@       
          %@%@@%%%%%%@####%##%%%@%%%#####%@%#%%#%#%%@@%@#@=-@..--..@@*#%*       
        ++=%%%%%%%%%@#%#####%@@@@@%%%%%####%##%##%@%%%%%%@@###%%@%%@            
        +++%%##%%%%@#%#######@%##+##*#%%#%#%%%%###%%%%%%%#%%%%%#%@              
         ++=%%%%%%%%@%%%######@%####:=+%%#######%%@%%%%%%%%%%@*                 
            .@@%%%%%@%%%%%%%###%%##*:=*%%%%%%%%%%@%%@%%%@                       
            @%%%%%%%%@%%%%%%%%%%%##%:@%%%%%%%%%%@                               
             @@@@    @#%@@%%@%%%%@#%=%@%%%%%%%@                                 
                        .@@%@@@####.:*%%%%@@@%=                                 
                              %@@#*@*@   %%%%.                                  
                               @#@        @*@                                   
                               @+@         *=                                   
                               %+@         %=-=                                 
                   .:::::::::@@+==%.::::%#*#**%=@@=+@%%:::::                    
              .:::::::::::@@=*@+%%@**%%:::::::.%*%%@::::::::::::                
                  .::::::%..:::%%@:::::#:::::::::::::::::::                     
                                                                                                                                                                                                                                                                          
 _____           _              ____  _ _       
|_   _|   _ _ __| | _____ _   _| __ )(_) |_ ___ 
  | || | | | '__| |/ / _ \ | | |  _ \| | __/ _ \\
  | || |_| | |  |   <  __/ |_| | |_) | | ||  __/
  |_| \__,_|_|  |_|\_\___|\__, |____/|_|\__\___|
 _     _ _                |___/                 
| |   (_) |__  _ __ __ _ _ __(_) __ _ _ __      
| |   | | '_ \| '__/ _\` | '__| |/ _\` | '_  \\     
| |___| | |_) | | | (_| | |  | | (_| | | | |    
|_____|_|_.__/|_|  \__,_|_|  |_|\__,_|_| |_|    

EOF

export VALKEY_PASSWORD=$(cat /run/secrets/valkey_password)
export TURKEYBITE_HOSTS_INTERVAL_MIN=${TURKEYBITE_HOSTS_INTERVAL_MIN:-720}
export TURKEYBITE_IGNORELIST_INTERVAL_MIN=${TURKEYBITE_IGNORELIST_INTERVAL_MIN:-5}

# Export OpenSearch credentials - these will be available to the template script
export OPENSEARCH_HOST=${OPENSEARCH_HOST:-opensearch}
export OPENSEARCH_USERNAME=${OPENSEARCH_USERNAME:-admin}
export OPENSEARCH_PASSWORD=${OPENSEARCH_PASSWORD:-Changeit12345!}

cat /etc/supervisor/conf.d/tb-librarian-hosts.template | envsubst | tee /etc/supervisor/conf.d/tb-librarian-hosts.conf
cat /etc/supervisor/conf.d/tb-librarian-ignorelist.template | envsubst | tee /etc/supervisor/conf.d/tb-librarian-ignorelist.conf
cat /etc/supervisor/conf.d/tb-opensearch-template.template | envsubst | tee /etc/supervisor/conf.d/tb-opensearch-template.conf
/usr/bin/supervisord -c /etc/supervisor/supervisord.conf
