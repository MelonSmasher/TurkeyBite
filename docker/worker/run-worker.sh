#! /bin/sh


cat <<EOF

                                        :*#*                                    
                                    :****=:---:*                                
                                  *-===---*=----:#*                             
                                *:==----=---=:---.*.:                           
                               +===-----:=---=----:-.*                          
                              #====-------=-:*--:--*-.-                         
                             *=============:----------#                         
                             *=-==*=========--------=--*                        
                            *#*==++:---------::---..+++=.                       
                           *-+==%%%@@@@%%%+===+=:..:....:#                      
                            =#+=#####@@%##*%%%#%%%##%%%%###                     
                      ++++++  :*##****@::@%#***#%**@#@                          
                .++++ ++%##%%+++@#***#@-:.@.:@#@%+@.*                           
               +++++%%@%##%%%%%#@#***#*#@@@@##-+-::%*          @%@%             
              *++%%#%%%@%%#%##%#%%%#*****#%---------:%       @.==%    %%        
           ++++=%%###%%%@#%##%%%#%#@@##*%=#@%%%@=+---:     %.===@    +@=%       
          ++++%%%@##%%%%%@%#%###%%%%%%%#@=======@%@%--    .*====@    @==%       
         ++++%%%%%%@%#%%%%%%%%%@%%%@%%@@####@##     %*     *=====%%%@.==@       
          ++%%%%%%%%%@#%%%%@%%%%%%%%%%@%@**#%##%           @*===========@       
         ++:%%##%%%%%%@%%%%%%%%@%%%@%@%%@***##**            %*%=======+=        
        +++%#%#%%#%%%%%%%%%%@@######@@@@##****#*%           @++****%%           
       +++%%%%%#%%@@%%%%%@%##########%###*#******@         -:++++%              
       .++%#%#%%@#%%%@@%@#@############%#*******%@      %#@@+++-%               
         @@#%%%#%%%%%%%@############%###%@@##@##@##%   %###*%###@.              
        .++%%%#%@@%@%%%########%%%@%###############@%#@#@##%%%###%              
        +++%###%%%%%%@%%##########%%%#%%###########%%%%%%*@%####%               
        :++%#%##%%%%%@@%%%#########%%%######%%#####@%%%%-%%@%%#@                
         .++#%%%@@%%%%%@@%%%%%%#####%%%%##%######%%%%%%%+*%###@                 
            %%%%%%%%%@%%@@%%%#######%%%%%%%%%%%%%%@%%#@+#+**                    
            %%%%%%@=    @@%%%#####%@%%%%%%%%%%%%%-   %:=+++@                    
                          @%%%@%@%%%%%@%%%%%%@@@    @+++++%                     
                              @%%%%%%@@@@%%@%%      *+..#+                      
                               %%@%%     @@%@.      @#++*#                      
                               %*%         %+@                                  
                               @#%          *++                                 
                        .::::::##@:::::::@#=*+#=#%:=*=@                         
              .:::::::::::%=###@=*==-=@:#:%@+@@+#=@@@@=@::::::.                 
                ::::::::*@@@@::=#+:@@*@@:::::::::-%-@::::::::.                  
                           .-:::%@::::::::::::::::                              
 _____           _               ____  _ _       
|_   _|   _ _ __| | _____ _   _ | __ )(_) |_ ___ 
  | || | | | '__| |/ / _ \ | | ||  _ \| | __/ _ \\
  | || |_| | |  |   <  __/ |_| || |_) | | ||  __/
__|_| \__,_|_|  |_|\_\___|\__, ||____/|_|\__\___|
\ \      / /__  _ __| | __|___/ __                
 \ \ /\ / / _ \| '__| |/ / _ \ '__|               
  \ V  V / (_) | |  |   <  __/ |                  
   \_/\_/ \___/|_|  |_|\_\___|_|                             

EOF

export VALKEY_PASSWORD=$(cat /run/secrets/valkey_password)
export VALKEY_HOST=${VALKEY_HOST:-valkey}
export VALKEY_PORT=${VALKEY_PORT:-6379}
export VALKEY_DB=${VALKEY_DB:-0}
export TURKEYBITE_WORKER_PROCS=${TURKEYBITE_WORKER_PROCS:-2}

cat /etc/supervisor/conf.d/tb-worker.template | envsubst | tee /etc/supervisor/conf.d/tb-worker.conf
/usr/bin/supervisord -c /etc/supervisor/supervisord.conf
